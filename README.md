# 快眠ドア守り

## 概要
本プロジェクトは、CO₂濃度を測定し、一定の閾値を超えた場合に「小型の模擬ドア」を自動で開閉する、換気補助用IoTシステムのプロトタイプです。Node.js、Raspberry Pi、MQTTなどを用いて構築されており、寝室などの密閉空間における空気質の改善を目的とした制御実験を行いました。

## 機能
- CO₂センサーによるリアルタイム濃度測定  
- MQTT通信を用いたセンサーユニットとモーター制御ユニットの連携  
- 一定時間安全値が継続した際にドアを自動で閉める機能  
- 実環境での動作実験ログの取得  

## 使用方法
1. 両方のRaspberry Piを起動し、それぞれに対応するコードを実行します。
   - **センサーユニット**：CO₂濃度を測定し、MQTTで閾値判定結果をpublish  
   - **モーター制御ユニット**：MQTTでメッセージをsubscribeし、ドア開閉を制御  
2. CO₂濃度が設定した閾値を超えると、自動でドアを開けます。  
3. 一定時間、CO₂濃度が安全値を下回った場合にドアを自動で閉めます。  

## 必要な環境

### ハードウェア
- Raspberry Pi Zero WH ×2台  
  （センサーユニット用 / モーター制御用）
- モータドライバ：MX1508  
- ミニギアモーター ×2（タイヤ付き）  
- サーボ用モータドライバ：PCA9685  
- サーボモーター：SG90  
- CO₂センサー：MH-Z19（PWMモード使用）  

### ソフトウェア / ライブラリ
- Node.js（制御スクリプトの記述に使用）  
- CHIRIMEN for Raspberry Pi（I²C制御）  
- Mosquitto（MQTTブローカー）  
- MQTTライブラリ（例：`mqtt` npmパッケージ）  
- pigpio（GPIO制御・PWM読み取り）  

### 補足
※ 本リポジトリは、本プロジェクトにおける「モーター制御ユニット」の実装部分に対応しています。センサーユニット側のコードや構成は含まれておりません。

# おまけ（CO₂モニター（実験用））

## 概要
CHIRIMEN対応のSCD40センサーを用いて、CO₂濃度を5分ごとに計測し、CSVに記録するスクリプトです。

## 使用ファイル
- co2_monitor.js

## 動作環境
- Raspberry Pi Zero WH
- Node.js
- SCD40センサー
- fsモジュール（標準）